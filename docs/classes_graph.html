<html>
    <head>
        <meta charset="utf-8">
        
            
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/dist/vis-network.min.css" integrity="sha512-WgxfT5LWjfszlPHXRmBWHkV2eceiWTOBvrKCNbdgDYTHrT2AeLCGbF4sZlZw3UMN3WtL0tGUoIAKsu8mllg/XA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
            <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/vis-network.min.js" integrity="sha512-LnvoEWDFrqGHlHmDD2101OrLcbsfkrzoSpvtSQtxK3RMnRV0eOkhhBN2dXHKRrUU8p2DGRTk35n4O8nWSVe1mQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
            
        
<center>
<h1></h1>
</center>

<!-- <link rel="stylesheet" href="../node_modules/vis/dist/vis.min.css" type="text/css" />
<script type="text/javascript" src="../node_modules/vis/dist/vis.js"> </script>-->
        <link
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
          crossorigin="anonymous"
        />
        <script
          src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
          crossorigin="anonymous"
        ></script>


        <center>
          <h1></h1>
        </center>
        <style type="text/css">

             #mynetwork {
                 width: 100%;
                 height: 800px;
                 background-color: #ffffff;
                 border: 1px solid lightgray;
                 position: relative;
                 float: left;
             }

             

             

             
        </style>
    </head>


    <body>
        <div class="card" style="width: 100%">
            
            
            <div id="mynetwork" class="card-body"></div>
        </div>

        
        

        <script type="text/javascript">

              // initialize global variables.
              var edges;
              var nodes;
              var allNodes;
              var allEdges;
              var nodeColors;
              var originalNodes;
              var network;
              var container;
              var options, data;
              var filter = {
                  item : '',
                  property : '',
                  value : []
              };

              

              

              // This method is responsible for drawing the graph, returns the drawn network
              function drawGraph() {
                  var container = document.getElementById('mynetwork');

                  

                  // parsing and collecting nodes and edges from the python
                  nodes = new vis.DataSet([{"color": "#bbdefb", "font": {"color": "#000000"}, "id": "src/syntax_highlighter.py::PythonSyntaxHighlighter", "label": "PythonSyntaxHighlighter", "shape": "dot", "size": 25, "title": "\u003cb\u003ePythonSyntaxHighlighter\u003c/b\u003e\u003cbr\u003eArquivo: syntax_highlighter.py\u003cbr\u003eLinha: 9\u003cbr\u003eM\u00e9todos: 7\u003cbr\u003eAtributos: 0\u003cbr\u003e"}, {"color": "#c5cae9", "font": {"color": "#000000"}, "id": "src/ai_config.py::AIConfig", "label": "AIConfig", "shape": "dot", "size": 27, "title": "\u003cb\u003eAIConfig\u003c/b\u003e\u003cbr\u003eArquivo: ai_config.py\u003cbr\u003eLinha: 11\u003cbr\u003eM\u00e9todos: 9\u003cbr\u003eAtributos: 0\u003cbr\u003e"}, {"color": "#e1bee7", "font": {"color": "#000000"}, "id": "src/analyzer.py::ProjectAnalyzer", "label": "ProjectAnalyzer", "shape": "dot", "size": 27, "title": "\u003cb\u003eProjectAnalyzer\u003c/b\u003e\u003cbr\u003eArquivo: analyzer.py\u003cbr\u003eLinha: 16\u003cbr\u003eM\u00e9todos: 9\u003cbr\u003eAtributos: 0\u003cbr\u003e"}, {"color": "#e1bee7", "font": {"color": "#000000"}, "id": "src/analyzer.py::FileAnalyzer", "label": "FileAnalyzer", "shape": "dot", "size": 25, "title": "\u003cb\u003eFileAnalyzer\u003c/b\u003e\u003cbr\u003eArquivo: analyzer.py\u003cbr\u003eLinha: 345\u003cbr\u003eM\u00e9todos: 7\u003cbr\u003eAtributos: 0\u003cbr\u003eHerda de: ast.NodeVisitor"}, {"color": "#ffcdd2", "font": {"color": "#000000"}, "id": "src/html_generator.py::HTMLGenerator", "label": "HTMLGenerator", "shape": "dot", "size": 39, "title": "\u003cb\u003eHTMLGenerator\u003c/b\u003e\u003cbr\u003eArquivo: html_generator.py\u003cbr\u003eLinha: 16\u003cbr\u003eM\u00e9todos: 13\u003cbr\u003eAtributos: 0\u003cbr\u003e"}, {"color": "#ffcdd2", "font": {"color": "#000000"}, "id": "src/models.py::ImportInfo", "label": "ImportInfo", "shape": "dot", "size": 25, "title": "\u003cb\u003eImportInfo\u003c/b\u003e\u003cbr\u003eArquivo: models.py\u003cbr\u003eLinha: 11\u003cbr\u003eM\u00e9todos: 0\u003cbr\u003eAtributos: 0\u003cbr\u003e"}, {"color": "#ffcdd2", "font": {"color": "#000000"}, "id": "src/models.py::ClassInfo", "label": "ClassInfo", "shape": "dot", "size": 25, "title": "\u003cb\u003eClassInfo\u003c/b\u003e\u003cbr\u003eArquivo: models.py\u003cbr\u003eLinha: 20\u003cbr\u003eM\u00e9todos: 0\u003cbr\u003eAtributos: 0\u003cbr\u003e"}, {"color": "#ffcdd2", "font": {"color": "#000000"}, "id": "src/models.py::FunctionInfo", "label": "FunctionInfo", "shape": "dot", "size": 25, "title": "\u003cb\u003eFunctionInfo\u003c/b\u003e\u003cbr\u003eArquivo: models.py\u003cbr\u003eLinha: 32\u003cbr\u003eM\u00e9todos: 0\u003cbr\u003eAtributos: 0\u003cbr\u003e"}, {"color": "#ffcdd2", "font": {"color": "#000000"}, "id": "src/models.py::FileInfo", "label": "FileInfo", "shape": "dot", "size": 25, "title": "\u003cb\u003eFileInfo\u003c/b\u003e\u003cbr\u003eArquivo: models.py\u003cbr\u003eLinha: 42\u003cbr\u003eM\u00e9todos: 0\u003cbr\u003eAtributos: 0\u003cbr\u003e"}, {"color": "#ffcdd2", "font": {"color": "#000000"}, "id": "src/models.py::AnalysisResult", "label": "AnalysisResult", "shape": "dot", "size": 25, "title": "\u003cb\u003eAnalysisResult\u003c/b\u003e\u003cbr\u003eArquivo: models.py\u003cbr\u003eLinha: 59\u003cbr\u003eM\u00e9todos: 0\u003cbr\u003eAtributos: 0\u003cbr\u003e"}, {"color": "#f8bbd9", "font": {"color": "#000000"}, "id": "src/graph_generator.py::GraphGenerator", "label": "GraphGenerator", "shape": "dot", "size": 33, "title": "\u003cb\u003eGraphGenerator\u003c/b\u003e\u003cbr\u003eArquivo: graph_generator.py\u003cbr\u003eLinha: 13\u003cbr\u003eM\u00e9todos: 11\u003cbr\u003eAtributos: 0\u003cbr\u003e"}, {"color": "#bbdefb", "font": {"color": "#000000"}, "id": "src/ai_analyzer.py::DocumentationResult", "label": "DocumentationResult", "shape": "dot", "size": 25, "title": "\u003cb\u003eDocumentationResult\u003c/b\u003e\u003cbr\u003eArquivo: ai_analyzer.py\u003cbr\u003eLinha: 20\u003cbr\u003eM\u00e9todos: 0\u003cbr\u003eAtributos: 0\u003cbr\u003e"}, {"color": "#bbdefb", "font": {"color": "#000000"}, "id": "src/ai_analyzer.py::AICodeAnalyzer", "label": "AICodeAnalyzer", "shape": "dot", "size": 33, "title": "\u003cb\u003eAICodeAnalyzer\u003c/b\u003e\u003cbr\u003eArquivo: ai_analyzer.py\u003cbr\u003eLinha: 31\u003cbr\u003eM\u00e9todos: 11\u003cbr\u003eAtributos: 0\u003cbr\u003e"}, {"color": "#e1bee7", "font": {"color": "#000000"}, "id": "src/config_loader.py::ConfigLoader", "label": "ConfigLoader", "shape": "dot", "size": 25, "title": "\u003cb\u003eConfigLoader\u003c/b\u003e\u003cbr\u003eArquivo: config_loader.py\u003cbr\u003eLinha: 10\u003cbr\u003eM\u00e9todos: 4\u003cbr\u003eAtributos: 0\u003cbr\u003e"}]);
                  edges = new vis.DataSet([]);

                  nodeColors = {};
                  allNodes = nodes.get({ returnType: "Object" });
                  for (nodeId in allNodes) {
                    nodeColors[nodeId] = allNodes[nodeId].color;
                  }
                  allEdges = edges.get({ returnType: "Object" });
                  // adding nodes and edges to the graph
                  data = {nodes: nodes, edges: edges};

                  var options = {"interaction": {"hover": true}, "manipulation": {"enabled": false}, "physics": {"enabled": true, "stabilization": {"iterations": 100}}, "layout": {"improvedLayout": false, "randomSeed": 42}};

                  


                  

                  network = new vis.Network(container, data, options);

                  

                  

                  


                  

                  return network;

              }
              drawGraph();
        </script>
    
<script>
// Variables for filtering (check if they already exist)
if (typeof originalNodes === 'undefined') {
    var originalNodes = null;
}
if (typeof originalEdges === 'undefined') {
    var originalEdges = null;
}
if (typeof isFiltered === 'undefined') {
    var isFiltered = false;
}

// Store original data
function storeOriginalData() {
    if (!originalNodes && !originalEdges) {
        originalNodes = nodes.get();
        originalEdges = edges.get();
    }
}

// Filter functionality
window.addEventListener('message', function(event) {
    if (event.data.action === 'filterBySearch') {
        filterBySearch(event.data.searchTerm);
    } else if (event.data.action === 'filterByFile') {
        filterByFile(event.data.filePath);
    } else if (event.data.action === 'resetFilter') {
        resetFilter();
    }
});

function filterBySearch(searchTerm) {
    storeOriginalData();
    
    const filteredNodes = originalNodes.filter(node => {
        const label = node.label.toLowerCase();
        const id = node.id.toLowerCase();
        const title = (node.title || '').toLowerCase();
        const search = searchTerm.toLowerCase();
        
        return label.includes(search) || id.includes(search) || title.includes(search);
    });
    
    const filteredNodeIds = new Set(filteredNodes.map(n => n.id));
    const filteredEdges = originalEdges.filter(edge => 
        filteredNodeIds.has(edge.from) && filteredNodeIds.has(edge.to)
    );
    
    nodes.clear();
    edges.clear();
    nodes.add(filteredNodes);
    edges.add(filteredEdges);
    
    isFiltered = true;
    network.fit();
}

function filterByFile(filePath) {
    storeOriginalData();
    
    // Find the target node
    const targetNode = originalNodes.find(node => node.id === filePath);
    if (!targetNode) return;
    
    // Find all connected nodes (dependencies and dependents)
    const connectedNodeIds = new Set([filePath]);
    const connectedEdges = [];
    
    originalEdges.forEach(edge => {
        if (edge.from === filePath || edge.to === filePath) {
            connectedNodeIds.add(edge.from);
            connectedNodeIds.add(edge.to);
            connectedEdges.push(edge);
        }
    });
    
    const filteredNodes = originalNodes.filter(node => 
        connectedNodeIds.has(node.id)
    );
    
    nodes.clear();
    edges.clear();
    nodes.add(filteredNodes);
    edges.add(connectedEdges);
    
    isFiltered = true;
    
    // Highlight the selected node
    const updatedTargetNode = {...targetNode, color: {
        background: '#ff6b6b',
        border: '#ff5252',
        highlight: {background: '#ff8a80', border: '#ff5252'}
    }};
    nodes.update(updatedTargetNode);
    
    network.fit();
    
    // Focus on the target node
    network.focus(filePath, {scale: 1.5, animation: true});
}

function resetFilter() {
    if (originalNodes && originalEdges) {
        nodes.clear();
        edges.clear();
        nodes.add(originalNodes);
        edges.add(originalEdges);
        isFiltered = false;
        network.fit();
    }
}

// Adiciona handler de clique nos nós para mostrar código fonte
network.on("click", function(params) {
    if (params.nodes.length > 0) {
        const nodeId = params.nodes[0];
        const nodeData = nodes.get(nodeId);
        
        if (nodeData && nodeData.label) {
            // Para nós de arquivo, usa o id diretamente
            // Para nós de classe, extrai o arquivo do tooltip
            let filePath = nodeId;
            let displayName = nodeData.label;
            
            // Se o tooltip contém "Arquivo:", é uma classe
            if (nodeData.title && nodeData.title.includes('Arquivo:')) {
                const match = nodeData.title.match(/Arquivo: ([^<]+)/);
                if (match) {
                    // Encontra o arquivo correspondente baseado no nome
                    const fileName = match[1];
                    filePath = nodeId.split('::')[0] || filePath;
                }
            }
            
            // Tenta múltiplas estratégias de comunicação
            try {
                // Estratégia 1: PostMessage (funciona em file:// e http://)
                if (window.parent && window.parent !== window) {
                    window.parent.postMessage({
                        action: 'showSourceCode',
                        filePath: filePath,
                        displayName: displayName
                    }, '*');
                    return;
                }
                
                // Estratégia 2: Acesso direto (funciona em http://)
                if (window.parent && 
                    window.parent !== window && 
                    typeof window.parent.showSourceCode === 'function') {
                    window.parent.showSourceCode(filePath, displayName);
                    return;
                }
                
                // Estratégia 3: window.top (alternativa)
                if (window.top && 
                    window.top !== window && 
                    typeof window.top.showSourceCode === 'function') {
                    window.top.showSourceCode(filePath, displayName);
                    return;
                }
                
                // Fallback: exibe informações do nó quando não consegue comunicar
                const info = 'Arquivo: ' + nodeId + '\\nClasse/Módulo: ' + nodeData.label;
                if (confirm('Visualizar informações do nó?\\n\\n' + info + '\\n\\nClique OK para copiar o caminho.')) {
                    // Tenta copiar para área de transferência
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(nodeId);
                    }
                }
                
            } catch (e) {
                // Erro de cross-origin ou outro problema
                console.log('Info do nó:', nodeData.label, 'Caminho:', nodeId);
                
                // Fallback silencioso - apenas log
                const info = 'Módulo: ' + nodeData.label + '\\nCaminho: ' + nodeId;
                console.log('Para visualizar o código, abra o arquivo diretamente:', info);
            }
        }
    }
});

// Initialize when network is ready
network.once('stabilized', function() {
    storeOriginalData();
});
</script>
</body>
</html>